{
    "$schema": "https://schema.railpack.com/v2",
    "steps": {
        "install": {
            "commands" : [
                "php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\"",
                "php composer-setup.php --install-dir=/usr/local/bin --filename=composer",
                "rm composer-setup.php",
                "composer install --no-dev --optimize-autoloader --no-interaction"
            ]
        },
        "build" : {
            "commands": [
                "ls -a",
                "echo 'fucking let the cache go'",
                "mkdir /app",
                "cp -R . /app",
                "cd /app",
                "php bin/console cache:clear --env=$APP_ENV",
                "php bin/console cache:warmup --env=$APP_ENV",
                "php bin/console doctrine:migrations:migrate --no-interaction --env=$APP_ENV || true"
            ]
        }   
    },
    "deploy" : {
        "startCommand" : "frankenphp php-server --listen=0.0.0.0 --root=public",
        "inputs": [
            {
                "step": "build",
                "include": [".", "/app"]
            }
        ],
        "paths": [],
        "base": null
    }
}